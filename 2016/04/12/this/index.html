<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>this · mrluo</title><meta name="description" content="this - mrluo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><!-- fonts--><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://fonts.lug.ustc.edu.cn/css?family=Source+Sans+Pro:400,600" type="text/css"><!-- baidu analytics--><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3ee91d14584b24f0f7509f558e910b42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script></head><body><input type="checkbox" id="sidebar-toggle"><aside><div class="author"><a href="/."><img src="/img/author.png" class="author-img"></a><h2 class="author-name">mrluo</h2></div><div class="post-toc"><span class="toc-title">Directory</span><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同EC下的this"><span class="toc-text">不同EC下的this</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#全局EC中的this"><span class="toc-text">全局EC中的this</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数EC中的this"><span class="toc-text">函数EC中的this</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同的调用方式是如何影响this值"><span class="toc-text">不同的调用方式是如何影响this值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li></ol></div></aside><div class="main"><header><div id="top"><a href="/." class="logo-link">mrluo</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">Tags</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">Rss</a></li><li class="nav-list-item"><a href="/sitemap.xml" target="_self" class="nav-list-link">Sitemap</a></li></ul></div></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">this</h1><div class="post-time">Apr 12, 2016</div><div class="post-content"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这篇记录js中this关键字，这篇是建立在之前的<a href="/2016/04/12/执行上下文(Execution-Context)/" title="Execution-Context">Execution-Context</a>的基础上的，理解this的关键是要掌握了EC的内容。<br>这里先说明在js中的this跟OOP编程语言中的this不是一样,下面我们来看看在ECMAScript中的this</p>
<h3 id="不同EC下的this"><a href="#不同EC下的this" class="headerlink" title="不同EC下的this"></a>不同EC下的this</h3><p>this是执行上下文(EC)的一个属性，this与EC类型有关，其值在进入EC就确定了，并且在执行代码阶段是不能改变的。</p>
<h4 id="全局EC中的this"><a href="#全局EC中的this" class="headerlink" title="全局EC中的this"></a>全局EC中的this</h4><p>在全局的EC中，this指向的是全局对象自身，所以我们可以使用this来间接的使用全局对象：</p>
<h4 id="函数EC中的this"><a href="#函数EC中的this" class="headerlink" title="函数EC中的this"></a>函数EC中的this</h4><p>在函数EC中确定EC是理解this值最难的一个部分，因为this的确定是动态的，上面说了this是进入EC的时候确定的，在函数中每一次调用函数都会产生一个新的EC，这就意味this的值会随着每次不同的函数EC而不同。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;x: <span class="number">10</span>&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">  x: <span class="number">20</span>,</span><br><span class="line">  test: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">    alert(<span class="keyword">this</span> === bar); <span class="comment">// true</span></span><br><span class="line">    alert(<span class="keyword">this</span>.x); <span class="comment">// 20</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">this</span> = foo; <span class="comment">// error, 不能更改this的值</span></span><br><span class="line"> </span><br><span class="line">    alert(<span class="keyword">this</span>.x); <span class="comment">// 如果没有错误，则其值为10而不是20</span></span><br><span class="line"> </span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 在进入上下文的时候，this的值就确定了是“bar”对象</span></span><br><span class="line"><span class="comment">// 至于为什么，会在后面作详细介绍</span></span><br><span class="line"> </span><br><span class="line">bar.test(); <span class="comment">// true, 20</span></span><br><span class="line"> </span><br><span class="line">foo.test = bar.test;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 但是，这个时候，this的值又会变成“foo”</span></span><br><span class="line"><span class="comment">// 纵然我们调用的是同一个函数</span></span><br><span class="line"> </span><br><span class="line">foo.test(); <span class="comment">// false, 10</span></span><br></pre></td></tr></table></figure></p>
<p>this是由激活上下文的调用者提供，换句话说就是调用函数的父上下文，<strong>this的值确定于用何种方式调用函数</strong>。</p>
<h3 id="不同的调用方式是如何影响this值"><a href="#不同的调用方式是如何影响this值" class="headerlink" title="不同的调用方式是如何影响this值"></a>不同的调用方式是如何影响this值</h3><p>为了解释this值是如何确定的，我们有必要了解内部类型<code>引用类型(Reference)</code></p>
<p><code>引用类型(Reference)</code>:<br>用伪代码可以把引用类型表示为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> valueOfReferenceType = &#123;</span><br><span class="line">  base: &lt;base object&gt;,</span><br><span class="line">  propertyName: &lt;property name&gt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>引用类型只会存在于这两种情况：</p>
<ol>
<li>当我们处理标识符</li>
<li>或是一个属性访问器。<br>标识符的处理在中讨论，这里我们要知道<strong>处理标识符始终只会返回引用的类型</strong>（这对this来说很重要）.<br>标识符是函数、标量、形参、或者一个全局属性（不使用var声明直接赋值）的名称，例如：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a= <span class="number">123</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>程序处理时候转成<strong>引用类型</strong>：<br>var aReference = {<br>  base: global,<br>  propertyName: ‘a’<br>};<br>var testReference = {<br>  base: global,<br>  propertyName: ‘test’<br>};<br>为了从引用类型中得到对象真正的值，需要有一个GetValue的方法，所以伪代码为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetValue</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (Type(value) != Reference) &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> base = GetBase(value);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (base === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ReferenceError</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> base.[[Get]](GetPropertyName(value));</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3> </div></article></div><div class="tags"><a href="/tags/js/">js</a><a href="/tags/this/">this</a><a href="/tags/js深入系列/">js深入系列</a></div><div class="paginator"><a href="/2016/04/12/变量对象（Variable object）/" class="next"><span>Next</span><i class="fa fa-chevron-right"></i></a></div></section><footer><section id="comments"><div data-thread-key="http://mrluos.coding.io/2016/04/12/this/index.html" data-title="this" data-url="http://mrluos.coding.io/2016/04/12/this/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "mrluos" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section><div class="copyright"><p>© 2016<span class="heart"><i class="icon-next-heart fa fa-heart"></i></span><a href="http://mrluos.coding.io">mrluo</a></p></div></footer></div><label for="sidebar-toggle" class="sidebar-menu"><div class="menu"></div></label><label class="back2top"> <a href="#top"><div class="arrow"></div></a></label></body></html>